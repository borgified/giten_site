packages:
  yum:
    awscli: []
    git: []

commands:
  10_create_aws_folder:
    command: "if [ ! -d ~/.aws ]; then mkdir ~/.aws; fi"
  20_create_aws_credentials:
    command: "echo -e \"[default]\naws_access_key_id = ${LE_ACCESS_KEY_ID}\naws_secret_access_key = ${LE_SECRET_ACCESS_KEY}\" > ~/.aws/credentials"
  30_make_letsencrypt_folder:
    command: "if [ ! -d /opt/letsencrypt ]; then mkdir /opt/letsencrypt; fi"
  40_copy_renewal_script:
    command: "cp letsencrypt/renew_cert.sh /opt/letsencrypt/"
  50_make_it_executable:
    command: "chmod +x /opt/letsencrypt/renew_cert.sh"
  60_store_project_dir:
    command: "pwd > /opt/letsencrypt/prj_dir"
  70_create_cronjob:
    command: "echo \"15 * * * * /opt/letsencrypt/renew_cert.sh > /opt/letsencrypt/renewal.log 2>&1\" > /etc/cron.d/renew_letsencrypt"
    leader_only: true
  80_change_perms:
    command: "chmod 644 /etc/cron.d/renew_letsencrypt"
    leader_only: true
